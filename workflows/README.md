# Teisec Agent Workflow Capabilities

## Workflows Introduction and Benefits

Teisec Agent is designed to automate and streamline various security operations by leveraging custom workflows. These workflows integrate multiple plugins and capabilities to perform complex tasks such as email investigation, user activity monitoring, and threat intelligence analysis. By using Teisec Agent workflows, you can enhance your security operations, reduce manual effort, and improve response times.

## Parallel Tasks

Teisec Agent workflows support parallel task execution, allowing multiple tasks to run simultaneously. This feature is particularly useful for complex investigations that require data from various sources. By running tasks in parallel, you can significantly reduce the overall processing time and obtain comprehensive results faster.

## How to Invoke Workflows

To invoke a workflow, use the shortcut command followed by the required input parameters. For example:
```
/email sender_email_address=example@example.com subject_keyword=urgent
```
The system will provide updates on the progress of each step in the workflow, and once the workflow is complete, you can review the detailed report generated by the system.

## Available Workflows

### Email Investigation Workflow

**Shortcut:** `/email`

**Description:** This workflow investigates emails by retrieving details from Microsoft Sentinel, analyzing the content and headers, and investigating associated domains and IP addresses for threat intelligence indicators.

**Input Parameters:**
- `sender_email_address`: The email address of the sender to be investigated.
- `subject_keyword`: A keyword from the email subject to filter the emails.

**Steps:**
1. **Obtain Email Details**
   - **Plugin:** SentinelKQLPlugin
   - **Capability:** generateandrunkql
   - **Description:** Retrieve email details from Microsoft Sentinel using the sender email address and subject keyword.

2. **Extract Email Data**
   - **Plugin:** GraphAPIPlugin
   - **Capability:** getemaildetails
   - **Description:** Retrieve the body and headers of the email listed in the previous step.

3. **Analyze Email Content**
   - **Plugin:** GPTPlugin
   - **Capability:** runprompt
   - **Description:** Analyze the content of the email for suspicious links, attachments, and keywords.

4. **Analyze Email Headers**
   - **Plugin:** GPTPlugin
   - **Capability:** runprompt
   - **Description:** Analyze the headers of the email for suspicious email authentication details and extract the list of IP addresses and domains related to the email.

5. **Investigate Associated Domains**
   - **Plugin:** SentinelKQLPlugin
   - **Capability:** InvestigateDomainListThreatIntelligence
   - **Description:** Investigate the domains extracted from the email headers for any threat intelligence indicators.

6. **Investigate Associated IP Addresses**
   - **Plugin:** SentinelKQLPlugin
   - **Capability:** InvestigateIPListThreatIntelligence
   - **Description:** Investigate the IP addresses extracted from the email headers for any threat intelligence indicators.

7. **Generate Investigation Report**
   - **Plugin:** GPTPlugin
   - **Capability:** runprompt
   - **Description:** Generate a detailed report of the findings from the email investigation.

### User Investigation Workflow

**Shortcut:** `/user`

**Description:** This workflow investigates user activity by retrieving sign-in logs, failed sign-in attempts, security alerts, audit logs, device events, and behavior analytics data.

**Input Parameters:**
- `userPrincipalName`: The user principal name of the user to be investigated.

**Steps:**
1. **Get Recent Sign-In Logs**
   - **Plugin:** SentinelKQLPlugin
   - **Capability:** GetRecentSignInLogs
   - **Description:** Retrieve the most recent sign-in logs for the user.

2. **Get Failed Sign-In Attempts (Last 24h)**
   - **Plugin:** SentinelKQLPlugin
   - **Capability:** GetFailedSignInAttempts24h
   - **Description:** Retrieve the failed sign-in attempts for the user within the last 24 hours.

3. **Get User Security Alerts**
   - **Plugin:** SentinelKQLPlugin
   - **Capability:** GetUserSecurityAlerts
   - **Description:** Retrieve the security alerts generated in the last 7 days involving the user.

4. **Get User Audit Logs**
   - **Plugin:** SentinelKQLPlugin
   - **Capability:** GetUserAuditLogs
   - **Description:** Retrieve audit logs for the user.

5. **Get User Device Events**
   - **Plugin:** SentinelKQLPlugin
   - **Capability:** GetUserDeviceEvents
   - **Description:** Retrieve device events for the user.

6. **Get User Behavior Analytics**
   - **Plugin:** SentinelKQLPlugin
   - **Capability:** GetUserBehaviorAnalytics
   - **Description:** Retrieve behavior analytics data for the user.

7. **Get User Device Logon Events**
   - **Plugin:** SentinelKQLPlugin
   - **Capability:** GetUserDeviceLogonEvents
   - **Description:** Retrieve device logon events for the user.

8. **Investigate Associated IP Addresses**
   - **Plugin:** SentinelKQLPlugin
   - **Capability:** InvestigateIPListThreatIntelligence
   - **Description:** Investigate the IP addresses associated with the activity of the user for any threat intelligence indicators.

9. **Generate Investigation Report**
   - **Plugin:** GPTPlugin
   - **Capability:** runprompt
   - **Description:** Generate a detailed report of the findings from the user investigation.

## How to Create Custom Workflows

You can create custom workflows by defining new JSON files in the `workflows` folder. Each workflow should include the following sections:
- **Title:** The title of the workflow.
- **Shortcut:** A unique shortcut command to trigger the workflow.
- **Input Parameters:** A list of input parameters required for the workflow.
- **Steps:** A sequence of steps to be executed, each specifying the plugin, capability, and prompt text.

For more details on creating custom workflows, refer to the existing workflow JSON files in the `workflows` folder.

## Conclusion

Teisec Agent workflows provide a powerful way to automate and enhance your security operations. By leveraging the capabilities of various plugins, you can perform complex investigations and analyses with ease.
